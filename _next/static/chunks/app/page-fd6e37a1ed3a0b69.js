(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{5926:function(e,t,r){Promise.resolve().then(r.bind(r,8937))},8937:function(e,t,r){"use strict";r.d(t,{FareComparison:function(){return m}});var a=r(7437),s=r(2265);function i(e){return[e.directFare,e.stopover.leg1Fare,e.stopover.leg2Fare].some(e=>!Number.isInteger(e)||e<0)?{isValid:!1,reason:"Fare must be a non-negative integer."}:Number.isNaN(new Date(e.updatedAt).getTime())?{isValid:!1,reason:"updatedAt must be a valid ISO date string."}:{isValid:!0}}function n(e){let t=/^([01]\d|2[0-3]):([0-5]\d)$/.exec(e);return t?60*Number(t[1])+Number(t[2]):null}function l(e,t){let r=-1;for(let a of e){if(!a.trainId)return{isValid:!1,reason:"".concat(t,": trainId is required.")};let e=n(a.departAt),s=n(a.arriveAt);if(null===e||null===s)return{isValid:!1,reason:"".concat(t,": time must be HH:mm format.")};if(e>=s)return{isValid:!1,reason:"".concat(t,": departAt must be before arriveAt.")};if(e<r)return{isValid:!1,reason:"".concat(t,": entries must be sorted by departAt.")};r=e}return{isValid:!0}}function c(e,t){let r=l(e.direct,"".concat(t,".direct"));if(!r.isValid)return r;let a=l(e.leg1,"".concat(t,".leg1"));if(!a.isValid)return a;let s=l(e.leg2,"".concat(t,".leg2"));return s.isValid?{isValid:!0}:s}function o(e){if(!Number.isInteger(e.timetable.transferMin)||e.timetable.transferMin<0)return{isValid:!1,reason:"transferMin must be a non-negative integer."};let t=c(e.timetable.weekday.yasu_to_osaka,"yasu_to_osaka");if(!t.isValid)return t;let r=c(e.timetable.weekday.osaka_to_yasu,"osaka_to_yasu");return r.isValid?{isValid:!0}:r}function d(e){return new Intl.NumberFormat("ja-JP").format(e)}function u(e){return"".concat(e.departAt," 発 → ").concat(e.arriveAt," 着")}function m(e){let{master:t}=e,[r,l]=(0,s.useState)("yasu_to_osaka"),[c,m]=(0,s.useState)("09:00"),p=i(t),h=o(t);if(!p.isValid)return(0,a.jsxs)("section",{className:"panel",children:[(0,a.jsx)("h2",{className:"panelTitle",children:"比較結果"}),(0,a.jsxs)("p",{className:"errorText",children:["運賃データ確認中: ",p.reason]})]});let f=function(e){let t=i(e);if(!t.isValid)throw Error(t.reason);let r=e.stopover.leg1Fare+e.stopover.leg2Fare,a=Math.abs(e.directFare-r);return e.directFare===r?{directFare:e.directFare,stopoverTotalFare:r,diffYen:0,cheaper:"equal"}:{directFare:e.directFare,stopoverTotalFare:r,diffYen:a,cheaper:e.directFare<r?"direct":"stopover"}}(t),N="yasu_to_osaka"===r?{leg1:"野洲→京都",leg2:"京都→大阪"}:{leg1:"大阪→京都",leg2:"京都→野洲"},v="equal"===f.cheaper?"resultNeutral":"direct"===f.cheaper?"resultDirect":"resultStopover",x=(0,s.useMemo)(()=>{if(!h.isValid)return{direct:[],stopover:[]};try{return function(e,t,r){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3,s=o(e);if(!s.isValid)throw Error(s.reason);let i=n(r);if(null===i)throw Error("departureTime must be HH:mm format.");let l=e.timetable.weekday[t],c=e.timetable.transferMin,d=l.direct.filter(e=>{let t=n(e.departAt);return null!==t&&t>=i}).slice(0,a).map(e=>(function(e){let t=n(e.departAt),r=n(e.arriveAt);if(null===t||null===r)throw Error("Invalid timetable format.");return{routeType:"direct",departAt:e.departAt,arriveAt:e.arriveAt,durationMin:r-t,legs:[e]}})(e)),u=[];for(let e of l.leg1){let t=n(e.departAt),r=n(e.arriveAt);if(null===t||null===r||t<i)continue;let s=r+c,o=l.leg2.find(e=>{let t=n(e.departAt);return null!==t&&t>=s});if(!o)continue;let d=n(o.departAt),m=n(o.arriveAt);if(null!==d&&null!==m&&(u.push({routeType:"stopover",departAt:e.departAt,arriveAt:o.arriveAt,durationMin:m-t,legs:[e,o],transferWaitMin:d-r}),u.length>=a))break}return{direct:d,stopover:u}}(t,r,c,3)}catch(e){return{direct:[],stopover:[]}}},[c,r,t,h]);return(0,a.jsxs)("section",{className:"panel",children:[(0,a.jsxs)("h2",{className:"panelTitle",children:["yasu_to_osaka"===r?"野洲 → 大阪":"大阪 → 野洲","（大人IC）"]}),(0,a.jsxs)("div",{className:"routeFilters",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"filterLabel",children:"出発駅"}),(0,a.jsxs)("div",{className:"directionTabs",children:[(0,a.jsx)("button",{type:"button",className:"tabButton ".concat("yasu_to_osaka"===r?"tabActive":""),onClick:()=>l("yasu_to_osaka"),children:"野洲発"}),(0,a.jsx)("button",{type:"button",className:"tabButton ".concat("osaka_to_yasu"===r?"tabActive":""),onClick:()=>l("osaka_to_yasu"),children:"大阪発"})]})]}),(0,a.jsxs)("div",{className:"timePickerWrap",children:[(0,a.jsx)("label",{className:"filterLabel",htmlFor:"departure-time",children:"出発時刻"}),(0,a.jsx)("input",{id:"departure-time",className:"timeInput",type:"time",value:c,onChange:e=>m(e.target.value)})]})]}),(0,a.jsxs)("div",{className:"cardGrid",children:[(0,a.jsxs)("article",{className:"fareCard",children:[(0,a.jsx)("h3",{children:"そのまま直通"}),(0,a.jsxs)("p",{className:"fareValue",children:["\xa5",d(f.directFare)]})]}),(0,a.jsxs)("article",{className:"fareCard",children:[(0,a.jsx)("h3",{children:"京都で一度改札を出る"}),(0,a.jsxs)("p",{className:"fareValue",children:["\xa5",d(f.stopoverTotalFare)]}),(0,a.jsxs)("p",{className:"fareBreakdown",children:[N.leg1," \xa5",d(t.stopover.leg1Fare)," + ",N.leg2," \xa5",d(t.stopover.leg2Fare)]})]})]}),(0,a.jsx)("p",{className:"resultBanner ".concat(v),children:"equal"===f.cheaper?"同額です":"direct"===f.cheaper?"直通が ".concat(d(f.diffYen)," 円安いです"):"京都で途中下車が ".concat(d(f.diffYen)," 円安いです")}),(0,a.jsxs)("section",{className:"timeSection",children:[(0,a.jsx)("h3",{className:"timeSectionTitle",children:"時刻比較（平日・次の3本）"}),h.isValid?(0,a.jsxs)("div",{className:"timeColumns",children:[(0,a.jsxs)("article",{className:"timeCard",children:[(0,a.jsx)("h4",{children:"そのまま直通"}),0===x.direct.length?(0,a.jsx)("p",{className:"emptyRow",children:"該当する列車がありません（出発時刻を早めてください）"}):(0,a.jsx)("ul",{className:"timeList",children:x.direct.map((e,t)=>(0,a.jsxs)("li",{className:"timeRow",children:[(0,a.jsx)("p",{className:"routeSummary",children:u(e)}),(0,a.jsxs)("p",{className:"routeMeta",children:["所要 ",e.durationMin,"分"]})]},"direct-".concat(e.departAt,"-").concat(e.arriveAt,"-").concat(t)))})]}),(0,a.jsxs)("article",{className:"timeCard",children:[(0,a.jsx)("h4",{children:"京都で途中下車"}),0===x.stopover.length?(0,a.jsx)("p",{className:"emptyRow",children:"該当する列車がありません（出発時刻を早めてください）"}):(0,a.jsx)("ul",{className:"timeList",children:x.stopover.map((e,t)=>{var r;return(0,a.jsxs)("li",{className:"timeRow",children:[(0,a.jsx)("p",{className:"routeSummary",children:u(e)}),(0,a.jsxs)("p",{className:"routeMeta",children:["所要 ",e.durationMin,"分 / 京都で乗換 ",null!==(r=e.transferWaitMin)&&void 0!==r?r:0,"分"]})]},"stopover-".concat(e.departAt,"-").concat(e.arriveAt,"-").concat(t))})})]})]}):(0,a.jsxs)("p",{className:"errorText",children:["時刻表データ確認中: ",h.reason]})]}),(0,a.jsxs)("p",{className:"metaLine",children:["最終更新: ",new Date(t.updatedAt).toLocaleString("ja-JP")]})]})}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=5926)}),_N_E=e.O()}]);